<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Language/Haskell/TH/Quote.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes, ScopedTypeVariables, Safe #-}</span>
<a name="line-2"></a><span class='hs-comment'>{- |
<a name="line-3"></a>Module : Language.Haskell.TH.Quote
<a name="line-4"></a>Description : Quasi-quoting support for Template Haskell
<a name="line-5"></a>
<a name="line-6"></a>Template Haskell supports quasiquoting, which permits users to construct
<a name="line-7"></a>program fragments by directly writing concrete syntax.  A quasiquoter is
<a name="line-8"></a>essentially a function with takes a string to a Template Haskell AST.
<a name="line-9"></a>This module defines the 'QuasiQuoter' datatype, which specifies a
<a name="line-10"></a>quasiquoter @q@ which can be invoked using the syntax
<a name="line-11"></a>@[q| ... string to parse ... |]@ when the @QuasiQuotes@ language
<a name="line-12"></a>extension is enabled, and some utility functions for manipulating
<a name="line-13"></a>quasiquoters.  Nota bene: this package does not define any parsers,
<a name="line-14"></a>that is up to you.
<a name="line-15"></a>-}</span>
<a name="line-16"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Language.Haskell.TH.Quote</span><span class='hs-layout'>(</span>
<a name="line-17"></a>        <span class='hs-conid'>QuasiQuoter</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-varid'>quoteFile</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-comment'>-- * For backwards compatibility</span>
<a name="line-20"></a>        <span class='hs-varid'>dataToQa</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataToExpQ</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataToPatQ</span>
<a name="line-21"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.TH.Syntax</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span>
<a name="line-25"></a>
<a name="line-26"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- | The 'QuasiQuoter' type, a value @q@ of this type can be used</span>
<a name="line-27"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- in the syntax @[q| ... string to parse ...|]@.  In fact, for</span>
<a name="line-28"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- convenience, a 'QuasiQuoter' actually defines multiple quasiquoters</span>
<a name="line-29"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- to be used in different splice contexts; if you are only interested</span>
<a name="line-30"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- in defining a quasiquoter to be used for expressions, you would</span>
<a name="line-31"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- define a 'QuasiQuoter' with only 'quoteExp', and leave the other</span>
<a name="line-32"></a><a name="QuasiQuoter"></a><span class='hs-comment'>-- fields stubbed out with errors.</span>
<a name="line-33"></a><a name="QuasiQuoter"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>QuasiQuoter</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>QuasiQuoter</span> <span class='hs-layout'>{</span>
<a name="line-34"></a>    <span class='hs-comment'>-- | Quasi-quoter for expressions, invoked by quotes like @lhs = $[q|...]@</span>
<a name="line-35"></a>    <span class='hs-varid'>quoteExp</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span><span class='hs-layout'>,</span>
<a name="line-36"></a>    <span class='hs-comment'>-- | Quasi-quoter for patterns, invoked by quotes like @f $[q|...] = rhs@</span>
<a name="line-37"></a>    <span class='hs-varid'>quotePat</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Pat</span><span class='hs-layout'>,</span>
<a name="line-38"></a>    <span class='hs-comment'>-- | Quasi-quoter for types, invoked by quotes like @f :: $[q|...]@</span>
<a name="line-39"></a>    <span class='hs-varid'>quoteType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span>
<a name="line-40"></a>    <span class='hs-comment'>-- | Quasi-quoter for declarations, invoked by top-level quotes</span>
<a name="line-41"></a>    <span class='hs-varid'>quoteDec</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Dec</span><span class='hs-keyglyph'>]</span>
<a name="line-42"></a>    <span class='hs-layout'>}</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="quoteFile"></a><span class='hs-comment'>-- | 'quoteFile' takes a 'QuasiQuoter' and lifts it into one that read</span>
<a name="line-45"></a><span class='hs-comment'>-- the data out of a file.  For example, suppose @asmq@ is an</span>
<a name="line-46"></a><span class='hs-comment'>-- assembly-language quoter, so that you can write [asmq| ld r1, r2 |]</span>
<a name="line-47"></a><span class='hs-comment'>-- as an expression. Then if you define @asmq_f = quoteFile asmq@, then</span>
<a name="line-48"></a><span class='hs-comment'>-- the quote [asmq_f|foo.s|] will take input from file @"foo.s"@ instead</span>
<a name="line-49"></a><span class='hs-comment'>-- of the inline text</span>
<a name="line-50"></a><span class='hs-definition'>quoteFile</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>QuasiQuoter</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>QuasiQuoter</span>
<a name="line-51"></a><span class='hs-definition'>quoteFile</span> <span class='hs-layout'>(</span><span class='hs-conid'>QuasiQuoter</span> <span class='hs-layout'>{</span> <span class='hs-varid'>quoteExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>qe</span><span class='hs-layout'>,</span> <span class='hs-varid'>quotePat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>qp</span><span class='hs-layout'>,</span> <span class='hs-varid'>quoteType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>qt</span><span class='hs-layout'>,</span> <span class='hs-varid'>quoteDec</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>qd</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> 
<a name="line-52"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>QuasiQuoter</span> <span class='hs-layout'>{</span> <span class='hs-varid'>quoteExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>get</span> <span class='hs-varid'>qe</span><span class='hs-layout'>,</span> <span class='hs-varid'>quotePat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>get</span> <span class='hs-varid'>qp</span><span class='hs-layout'>,</span> <span class='hs-varid'>quoteType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>get</span> <span class='hs-varid'>qt</span><span class='hs-layout'>,</span> <span class='hs-varid'>quoteDec</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>get</span> <span class='hs-varid'>qd</span> <span class='hs-layout'>}</span>
<a name="line-53"></a>  <span class='hs-keyword'>where</span>
<a name="line-54"></a>   <span class='hs-varid'>get</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-varid'>a</span>
<a name="line-55"></a>   <span class='hs-varid'>get</span> <span class='hs-varid'>old_quoter</span> <span class='hs-varid'>file_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>file_cts</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>runIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>readFile</span> <span class='hs-varid'>file_name</span><span class='hs-layout'>)</span> 
<a name="line-56"></a>                                 <span class='hs-layout'>;</span> <span class='hs-varid'>addDependentFile</span> <span class='hs-varid'>file_name</span>
<a name="line-57"></a>                                 <span class='hs-layout'>;</span> <span class='hs-varid'>old_quoter</span> <span class='hs-varid'>file_cts</span> <span class='hs-layout'>}</span>
</pre></body>
</html>
