<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>dist-install/build/System/Posix/Process/Common.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LINE 1 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE CApiFFI #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE InterruptibleFFI, RankNTypes #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE Trustworthy #-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-7"></a><span class='hs-comment'>-- |</span>
<a name="line-8"></a><span class='hs-comment'>-- Module      :  System.Posix.Process.Common</span>
<a name="line-9"></a><span class='hs-comment'>-- Copyright   :  (c) The University of Glasgow 2002</span>
<a name="line-10"></a><span class='hs-comment'>-- License     :  BSD-style (see the file libraries/base/LICENSE)</span>
<a name="line-11"></a><span class='hs-comment'>--</span>
<a name="line-12"></a><span class='hs-comment'>-- Maintainer  :  libraries@haskell.org</span>
<a name="line-13"></a><span class='hs-comment'>-- Stability   :  provisional</span>
<a name="line-14"></a><span class='hs-comment'>-- Portability :  non-portable (requires POSIX)</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-- POSIX process support.  See also the System.Cmd and System.Process</span>
<a name="line-17"></a><span class='hs-comment'>-- modules in the process package.</span>
<a name="line-18"></a><span class='hs-comment'>--</span>
<a name="line-19"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>System.Posix.Process.Common</span> <span class='hs-layout'>(</span>
<a name="line-22"></a>    <span class='hs-comment'>-- * Processes</span>
<a name="line-23"></a>
<a name="line-24"></a>    <span class='hs-comment'>-- ** Forking and executing</span>
<a name="line-25"></a>    <span class='hs-varid'>forkProcess</span><span class='hs-layout'>,</span>
<a name="line-26"></a>    <span class='hs-varid'>forkProcessWithUnmask</span><span class='hs-layout'>,</span>
<a name="line-27"></a>
<a name="line-28"></a>    <span class='hs-comment'>-- ** Exiting</span>
<a name="line-29"></a>    <span class='hs-varid'>exitImmediately</span><span class='hs-layout'>,</span>
<a name="line-30"></a>
<a name="line-31"></a>    <span class='hs-comment'>-- ** Process environment</span>
<a name="line-32"></a>    <span class='hs-varid'>getProcessID</span><span class='hs-layout'>,</span>
<a name="line-33"></a>    <span class='hs-varid'>getParentProcessID</span><span class='hs-layout'>,</span>
<a name="line-34"></a>
<a name="line-35"></a>    <span class='hs-comment'>-- ** Process groups</span>
<a name="line-36"></a>    <span class='hs-varid'>getProcessGroupID</span><span class='hs-layout'>,</span>
<a name="line-37"></a>    <span class='hs-varid'>getProcessGroupIDOf</span><span class='hs-layout'>,</span>
<a name="line-38"></a>    <span class='hs-varid'>createProcessGroupFor</span><span class='hs-layout'>,</span>
<a name="line-39"></a>    <span class='hs-varid'>joinProcessGroup</span><span class='hs-layout'>,</span>
<a name="line-40"></a>    <span class='hs-varid'>setProcessGroupIDOf</span><span class='hs-layout'>,</span>
<a name="line-41"></a>
<a name="line-42"></a>    <span class='hs-comment'>-- ** Sessions</span>
<a name="line-43"></a>    <span class='hs-varid'>createSession</span><span class='hs-layout'>,</span>
<a name="line-44"></a>
<a name="line-45"></a>    <span class='hs-comment'>-- ** Process times</span>
<a name="line-46"></a>    <span class='hs-conid'>ProcessTimes</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-47"></a>    <span class='hs-varid'>getProcessTimes</span><span class='hs-layout'>,</span>
<a name="line-48"></a>
<a name="line-49"></a>    <span class='hs-comment'>-- ** Scheduling priority</span>
<a name="line-50"></a>    <span class='hs-varid'>nice</span><span class='hs-layout'>,</span>
<a name="line-51"></a>    <span class='hs-varid'>getProcessPriority</span><span class='hs-layout'>,</span>
<a name="line-52"></a>    <span class='hs-varid'>getProcessGroupPriority</span><span class='hs-layout'>,</span>
<a name="line-53"></a>    <span class='hs-varid'>getUserPriority</span><span class='hs-layout'>,</span>
<a name="line-54"></a>    <span class='hs-varid'>setProcessPriority</span><span class='hs-layout'>,</span>
<a name="line-55"></a>    <span class='hs-varid'>setProcessGroupPriority</span><span class='hs-layout'>,</span>
<a name="line-56"></a>    <span class='hs-varid'>setUserPriority</span><span class='hs-layout'>,</span>
<a name="line-57"></a>
<a name="line-58"></a>    <span class='hs-comment'>-- ** Process status</span>
<a name="line-59"></a>    <span class='hs-conid'>ProcessStatus</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-60"></a>    <span class='hs-varid'>getProcessStatus</span><span class='hs-layout'>,</span>
<a name="line-61"></a>    <span class='hs-varid'>getAnyProcessStatus</span><span class='hs-layout'>,</span>
<a name="line-62"></a>    <span class='hs-varid'>getGroupProcessStatus</span><span class='hs-layout'>,</span>
<a name="line-63"></a>
<a name="line-64"></a>    <span class='hs-comment'>-- ** Deprecated</span>
<a name="line-65"></a>    <span class='hs-varid'>createProcessGroup</span><span class='hs-layout'>,</span>
<a name="line-66"></a>    <span class='hs-varid'>setProcessGroupID</span><span class='hs-layout'>,</span>
<a name="line-67"></a>
<a name="line-68"></a> <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-69"></a>
<a name="line-70"></a>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.C.Error</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.C.Types</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.Marshal.Alloc</span> <span class='hs-layout'>(</span> <span class='hs-varid'>alloca</span><span class='hs-layout'>,</span> <span class='hs-varid'>allocaBytes</span> <span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.Ptr</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Ptr</span> <span class='hs-layout'>)</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.StablePtr</span> <span class='hs-layout'>(</span> <span class='hs-conid'>StablePtr</span><span class='hs-layout'>,</span> <span class='hs-varid'>newStablePtr</span><span class='hs-layout'>,</span> <span class='hs-varid'>freeStablePtr</span> <span class='hs-layout'>)</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign.Storable</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Storable</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-78"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System.Exit</span>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System.Posix.Process.Internals</span>
<a name="line-80"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System.Posix.Types</span>
<a name="line-81"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad</span>
<a name="line-82"></a>
<a name="line-83"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Exception.Base</span> <span class='hs-layout'>(</span> <span class='hs-varid'>bracket</span><span class='hs-layout'>,</span> <span class='hs-varid'>getMaskingState</span><span class='hs-layout'>,</span> <span class='hs-conid'>MaskingState</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span> <span class='hs-comment'>-- used by forkProcess</span>
<a name="line-84"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.TopHandler</span>   <span class='hs-layout'>(</span> <span class='hs-varid'>runIO</span> <span class='hs-layout'>)</span>
<a name="line-85"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.IO</span> <span class='hs-layout'>(</span> <span class='hs-varid'>unsafeUnmask</span><span class='hs-layout'>,</span> <span class='hs-varid'>uninterruptibleMask_</span> <span class='hs-layout'>)</span>
<a name="line-86"></a>
<a name="line-87"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-88"></a><span class='hs-comment'>-- Process environment</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="getProcessID"></a><span class='hs-comment'>-- | 'getProcessID' calls @getpid@ to obtain the 'ProcessID' for</span>
<a name="line-91"></a><span class='hs-comment'>--   the current process.</span>
<a name="line-92"></a><span class='hs-definition'>getProcessID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessID</span>
<a name="line-93"></a><span class='hs-definition'>getProcessID</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c_getpid</span>
<a name="line-94"></a>
<a name="line-95"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"getpid"</span>
<a name="line-96"></a>   <span class='hs-varid'>c_getpid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-97"></a>
<a name="line-98"></a><a name="getParentProcessID"></a><span class='hs-comment'>-- | 'getProcessID' calls @getppid@ to obtain the 'ProcessID' for</span>
<a name="line-99"></a><span class='hs-comment'>--   the parent of the current process.</span>
<a name="line-100"></a><span class='hs-definition'>getParentProcessID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessID</span>
<a name="line-101"></a><span class='hs-definition'>getParentProcessID</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c_getppid</span>
<a name="line-102"></a>
<a name="line-103"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"getppid"</span>
<a name="line-104"></a>  <span class='hs-varid'>c_getppid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="getProcessGroupID"></a><span class='hs-comment'>-- | 'getProcessGroupID' calls @getpgrp@ to obtain the</span>
<a name="line-107"></a><span class='hs-comment'>--   'ProcessGroupID' for the current process.</span>
<a name="line-108"></a><span class='hs-definition'>getProcessGroupID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-109"></a><span class='hs-definition'>getProcessGroupID</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c_getpgrp</span>
<a name="line-110"></a>
<a name="line-111"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"getpgrp"</span>
<a name="line-112"></a>  <span class='hs-varid'>c_getpgrp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-113"></a>
<a name="line-114"></a><a name="getProcessGroupIDOf"></a><span class='hs-comment'>-- | @'getProcessGroupIDOf' pid@ calls @getpgid@ to obtain the</span>
<a name="line-115"></a><span class='hs-comment'>--   'ProcessGroupID' for process @pid@.</span>
<a name="line-116"></a><span class='hs-definition'>getProcessGroupIDOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-117"></a><span class='hs-definition'>getProcessGroupIDOf</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span>
<a name="line-118"></a>  <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"getProcessGroupIDOf"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_getpgid</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-119"></a>
<a name="line-120"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"getpgid"</span>
<a name="line-121"></a>  <span class='hs-varid'>c_getpgid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CPid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-122"></a>
<a name="line-123"></a><span class='hs-comment'>{-
<a name="line-124"></a>   To be added in the future, after the deprecation period for the
<a name="line-125"></a>   existing createProcessGroup has elapsed:
<a name="line-126"></a>
<a name="line-127"></a>-- | 'createProcessGroup' calls @setpgid(0,0)@ to make
<a name="line-128"></a>--   the current process a new process group leader.
<a name="line-129"></a>createProcessGroup :: IO ProcessGroupID
<a name="line-130"></a>createProcessGroup = do
<a name="line-131"></a>  throwErrnoIfMinus1_ "createProcessGroup" (c_setpgid 0 0)
<a name="line-132"></a>  pgid &lt;- getProcessGroupID
<a name="line-133"></a>  return pgid
<a name="line-134"></a>-}</span>
<a name="line-135"></a>
<a name="line-136"></a><a name="createProcessGroupFor"></a><span class='hs-comment'>-- | @'createProcessGroupFor' pid@ calls @setpgid@ to make</span>
<a name="line-137"></a><span class='hs-comment'>--   process @pid@ a new process group leader.</span>
<a name="line-138"></a><span class='hs-definition'>createProcessGroupFor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-139"></a><span class='hs-definition'>createProcessGroupFor</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-140"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"createProcessGroupFor"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_setpgid</span> <span class='hs-varid'>pid</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-141"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>pid</span>
<a name="line-142"></a>
<a name="line-143"></a><a name="joinProcessGroup"></a><span class='hs-comment'>-- | @'joinProcessGroup' pgid@ calls @setpgid@ to set the</span>
<a name="line-144"></a><span class='hs-comment'>--   'ProcessGroupID' of the current process to @pgid@.</span>
<a name="line-145"></a><span class='hs-definition'>joinProcessGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessGroupID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-146"></a><span class='hs-definition'>joinProcessGroup</span> <span class='hs-varid'>pgid</span> <span class='hs-keyglyph'>=</span>
<a name="line-147"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"joinProcessGroup"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_setpgid</span> <span class='hs-num'>0</span> <span class='hs-varid'>pgid</span><span class='hs-layout'>)</span>
<a name="line-148"></a>
<a name="line-149"></a><span class='hs-comment'>{-
<a name="line-150"></a>   To be added in the future, after the deprecation period for the
<a name="line-151"></a>   existing setProcessGroupID has elapsed:
<a name="line-152"></a>
<a name="line-153"></a>-- | @'setProcessGroupID' pgid@ calls @setpgid@ to set the
<a name="line-154"></a>--   'ProcessGroupID' of the current process to @pgid@.
<a name="line-155"></a>setProcessGroupID :: ProcessGroupID -&gt; IO ()
<a name="line-156"></a>setProcessGroupID pgid =
<a name="line-157"></a>  throwErrnoIfMinus1_ "setProcessGroupID" (c_setpgid 0 pgid)
<a name="line-158"></a>-}</span>
<a name="line-159"></a>
<a name="line-160"></a><a name="setProcessGroupIDOf"></a><span class='hs-comment'>-- | @'setProcessGroupIDOf' pid pgid@ calls @setpgid@ to set the</span>
<a name="line-161"></a><span class='hs-comment'>--   'ProcessGroupIDOf' for process @pid@ to @pgid@.</span>
<a name="line-162"></a><span class='hs-definition'>setProcessGroupIDOf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ProcessGroupID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-163"></a><span class='hs-definition'>setProcessGroupIDOf</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>pgid</span> <span class='hs-keyglyph'>=</span>
<a name="line-164"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"setProcessGroupIDOf"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_setpgid</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>pgid</span><span class='hs-layout'>)</span>
<a name="line-165"></a>
<a name="line-166"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"setpgid"</span>
<a name="line-167"></a>  <span class='hs-varid'>c_setpgid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CPid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CPid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span>
<a name="line-168"></a>
<a name="line-169"></a><a name="createSession"></a><span class='hs-comment'>-- | 'createSession' calls @setsid@ to create a new session</span>
<a name="line-170"></a><span class='hs-comment'>--   with the current process as session leader.</span>
<a name="line-171"></a><span class='hs-definition'>createSession</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-172"></a><span class='hs-definition'>createSession</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"createSession"</span> <span class='hs-varid'>c_setsid</span>
<a name="line-173"></a>
<a name="line-174"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"setsid"</span>
<a name="line-175"></a>  <span class='hs-varid'>c_setsid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-176"></a>
<a name="line-177"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-178"></a><span class='hs-comment'>-- Process times</span>
<a name="line-179"></a>
<a name="line-180"></a><span class='hs-comment'>-- All times in clock ticks (see getClockTick)</span>
<a name="line-181"></a>
<a name="line-182"></a><a name="ProcessTimes"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ProcessTimes</span>
<a name="line-183"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ProcessTimes</span> <span class='hs-layout'>{</span> <span class='hs-varid'>elapsedTime</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClockTick</span>
<a name="line-184"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>userTime</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClockTick</span>
<a name="line-185"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>systemTime</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClockTick</span>
<a name="line-186"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>childUserTime</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClockTick</span>
<a name="line-187"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>childSystemTime</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClockTick</span>
<a name="line-188"></a>                 <span class='hs-layout'>}</span>
<a name="line-189"></a>
<a name="line-190"></a><a name="getProcessTimes"></a><span class='hs-comment'>-- | 'getProcessTimes' calls @times@ to obtain time-accounting</span>
<a name="line-191"></a><span class='hs-comment'>--   information for the current process and its children.</span>
<a name="line-192"></a><span class='hs-definition'>getProcessTimes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessTimes</span>
<a name="line-193"></a><span class='hs-definition'>getProcessTimes</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-194"></a>   <span class='hs-varid'>allocaBytes</span> <span class='hs-layout'>(</span><span class='hs-num'>32</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p_tms</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-195"></a><span class='hs-comment'>{-# LINE 194 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-196"></a>     <span class='hs-varid'>elapsed</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"getProcessTimes"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_times</span> <span class='hs-varid'>p_tms</span><span class='hs-layout'>)</span>
<a name="line-197"></a>     <span class='hs-varid'>ut</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>hsc_ptr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>peekByteOff</span> <span class='hs-varid'>hsc_ptr</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-varid'>p_tms</span>
<a name="line-198"></a><span class='hs-comment'>{-# LINE 196 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-199"></a>     <span class='hs-varid'>st</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>hsc_ptr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>peekByteOff</span> <span class='hs-varid'>hsc_ptr</span> <span class='hs-num'>8</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-varid'>p_tms</span>
<a name="line-200"></a><span class='hs-comment'>{-# LINE 197 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-201"></a>     <span class='hs-varid'>cut</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>hsc_ptr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>peekByteOff</span> <span class='hs-varid'>hsc_ptr</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>p_tms</span>
<a name="line-202"></a><span class='hs-comment'>{-# LINE 198 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-203"></a>     <span class='hs-varid'>cst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>hsc_ptr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>peekByteOff</span> <span class='hs-varid'>hsc_ptr</span> <span class='hs-num'>24</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>p_tms</span>
<a name="line-204"></a><span class='hs-comment'>{-# LINE 199 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-205"></a>     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ProcessTimes</span><span class='hs-layout'>{</span> <span class='hs-varid'>elapsedTime</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elapsed</span><span class='hs-layout'>,</span>
<a name="line-206"></a>                           <span class='hs-varid'>userTime</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ut</span><span class='hs-layout'>,</span>
<a name="line-207"></a>                           <span class='hs-varid'>systemTime</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>st</span><span class='hs-layout'>,</span>
<a name="line-208"></a>                           <span class='hs-varid'>childUserTime</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cut</span><span class='hs-layout'>,</span>
<a name="line-209"></a>                           <span class='hs-varid'>childSystemTime</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cst</span>
<a name="line-210"></a>                          <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-211"></a>
<a name="line-212"></a><a name="CTms"></a><span class='hs-keyword'>data</span> <span class='hs-comment'>{-# CTYPE "struct tms" #-}</span> <span class='hs-conid'>CTms</span>
<a name="line-213"></a>
<a name="line-214"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-varid'>capi</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"HsUnix.h times"</span>
<a name="line-215"></a>  <span class='hs-varid'>c_times</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CTms</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CClock</span>
<a name="line-216"></a>
<a name="line-217"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-218"></a><span class='hs-comment'>-- Process scheduling priority</span>
<a name="line-219"></a>
<a name="line-220"></a><a name="nice"></a><span class='hs-definition'>nice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-221"></a><span class='hs-definition'>nice</span> <span class='hs-varid'>prio</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-222"></a>  <span class='hs-varid'>resetErrno</span>
<a name="line-223"></a>  <span class='hs-varid'>res</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>c_nice</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>prio</span><span class='hs-layout'>)</span>
<a name="line-224"></a>  <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>res</span> <span class='hs-varop'>==</span> <span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-225"></a>    <span class='hs-varid'>err</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getErrno</span>
<a name="line-226"></a>    <span class='hs-varid'>when</span> <span class='hs-layout'>(</span><span class='hs-varid'>err</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>eOK</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>throwErrno</span> <span class='hs-str'>"nice"</span><span class='hs-layout'>)</span>
<a name="line-227"></a>
<a name="line-228"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"nice"</span>
<a name="line-229"></a>  <span class='hs-varid'>c_nice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span>
<a name="line-230"></a>
<a name="line-231"></a><a name="getProcessPriority"></a><span class='hs-definition'>getProcessPriority</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Int</span>
<a name="line-232"></a><a name="getProcessGroupPriority"></a><span class='hs-definition'>getProcessGroupPriority</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessGroupID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Int</span>
<a name="line-233"></a><a name="getUserPriority"></a><span class='hs-definition'>getUserPriority</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UserID</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Int</span>
<a name="line-234"></a>
<a name="line-235"></a><span class='hs-definition'>getProcessPriority</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-236"></a>  <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"getProcessPriority"</span> <span class='hs-varop'>$</span>
<a name="line-237"></a>         <span class='hs-varid'>c_getpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-238"></a><span class='hs-comment'>{-# LINE 232 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-239"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-240"></a>
<a name="line-241"></a><span class='hs-definition'>getProcessGroupPriority</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-242"></a>  <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"getProcessPriority"</span> <span class='hs-varop'>$</span>
<a name="line-243"></a>         <span class='hs-varid'>c_getpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-244"></a><span class='hs-comment'>{-# LINE 237 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-245"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-246"></a>
<a name="line-247"></a><span class='hs-definition'>getUserPriority</span> <span class='hs-varid'>uid</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-248"></a>  <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"getUserPriority"</span> <span class='hs-varop'>$</span>
<a name="line-249"></a>         <span class='hs-varid'>c_getpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>uid</span><span class='hs-layout'>)</span>
<a name="line-250"></a><span class='hs-comment'>{-# LINE 242 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-251"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-252"></a>
<a name="line-253"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"getpriority"</span>
<a name="line-254"></a>  <span class='hs-varid'>c_getpriority</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span>
<a name="line-255"></a>
<a name="line-256"></a><a name="setProcessPriority"></a><span class='hs-definition'>setProcessPriority</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-257"></a><a name="setProcessGroupPriority"></a><span class='hs-definition'>setProcessGroupPriority</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessGroupID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-258"></a><a name="setUserPriority"></a><span class='hs-definition'>setUserPriority</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UserID</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-259"></a>
<a name="line-260"></a><span class='hs-definition'>setProcessPriority</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>val</span> <span class='hs-keyglyph'>=</span>
<a name="line-261"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"setProcessPriority"</span> <span class='hs-varop'>$</span>
<a name="line-262"></a>    <span class='hs-varid'>c_setpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>val</span><span class='hs-layout'>)</span>
<a name="line-263"></a><span class='hs-comment'>{-# LINE 254 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-264"></a>
<a name="line-265"></a><span class='hs-definition'>setProcessGroupPriority</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>val</span> <span class='hs-keyglyph'>=</span>
<a name="line-266"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"setProcessPriority"</span> <span class='hs-varop'>$</span>
<a name="line-267"></a>    <span class='hs-varid'>c_setpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>val</span><span class='hs-layout'>)</span>
<a name="line-268"></a><span class='hs-comment'>{-# LINE 258 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-269"></a>
<a name="line-270"></a><span class='hs-definition'>setUserPriority</span> <span class='hs-varid'>uid</span> <span class='hs-varid'>val</span> <span class='hs-keyglyph'>=</span>
<a name="line-271"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"setUserPriority"</span> <span class='hs-varop'>$</span>
<a name="line-272"></a>    <span class='hs-varid'>c_setpriority</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>uid</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>val</span><span class='hs-layout'>)</span>
<a name="line-273"></a><span class='hs-comment'>{-# LINE 262 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-274"></a>
<a name="line-275"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"setpriority"</span>
<a name="line-276"></a>  <span class='hs-varid'>c_setpriority</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CInt</span>
<a name="line-277"></a>
<a name="line-278"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-279"></a><span class='hs-comment'>-- Forking, execution</span>
<a name="line-280"></a>
<a name="line-281"></a><span class='hs-comment'>{- | 'forkProcess' corresponds to the POSIX @fork@ system call.
<a name="line-282"></a>The 'IO' action passed as an argument is executed in the child process; no other
<a name="line-283"></a>threads will be copied to the child process.
<a name="line-284"></a>On success, 'forkProcess' returns the child's 'ProcessID' to the parent process;
<a name="line-285"></a>in case of an error, an exception is thrown.
<a name="line-286"></a>
<a name="line-287"></a>The exception masking state of the executed action is inherited
<a name="line-288"></a>(c.f. 'forkIO'), see also 'forkProcessWithUnmask' (/since: 2.7.0.0/).
<a name="line-289"></a>
<a name="line-290"></a>'forkProcess' comes with a giant warning: since any other running
<a name="line-291"></a>threads are not copied into the child process, it's easy to go wrong:
<a name="line-292"></a>e.g. by accessing some shared resource that was held by another thread
<a name="line-293"></a>in the parent.
<a name="line-294"></a>-}</span>
<a name="line-295"></a>
<a name="line-296"></a><a name="forkProcess"></a><span class='hs-definition'>forkProcess</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessID</span>
<a name="line-297"></a><span class='hs-definition'>forkProcess</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-298"></a>  <span class='hs-comment'>-- wrap action to re-establish caller's masking state, as</span>
<a name="line-299"></a>  <span class='hs-comment'>-- 'forkProcessPrim' starts in 'MaskedInterruptible' state by</span>
<a name="line-300"></a>  <span class='hs-comment'>-- default; see also #1048</span>
<a name="line-301"></a>  <span class='hs-varid'>mstate</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getMaskingState</span>
<a name="line-302"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>action'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mstate</span> <span class='hs-keyword'>of</span>
<a name="line-303"></a>          <span class='hs-conid'>Unmasked</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsafeUnmask</span> <span class='hs-varid'>action</span>
<a name="line-304"></a>          <span class='hs-conid'>MaskedInterruptible</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>action</span>
<a name="line-305"></a>          <span class='hs-conid'>MaskedUninterruptible</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>uninterruptibleMask_</span> <span class='hs-varid'>action</span>
<a name="line-306"></a>
<a name="line-307"></a>  <span class='hs-varid'>bracket</span>
<a name="line-308"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>newStablePtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>runIO</span> <span class='hs-varid'>action'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-309"></a>    <span class='hs-varid'>freeStablePtr</span>
<a name="line-310"></a>    <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>stable</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>throwErrnoIfMinus1</span> <span class='hs-str'>"forkProcess"</span> <span class='hs-layout'>(</span><span class='hs-varid'>forkProcessPrim</span> <span class='hs-varid'>stable</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-311"></a>
<a name="line-312"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-str'>"forkProcess"</span> <span class='hs-varid'>forkProcessPrim</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StablePtr</span> <span class='hs-layout'>(</span><span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-313"></a>
<a name="line-314"></a><a name="forkProcessWithUnmask"></a><span class='hs-comment'>-- | Variant of 'forkProcess' in the style of 'forkIOWithUnmask'.</span>
<a name="line-315"></a><span class='hs-comment'>--</span>
<a name="line-316"></a><span class='hs-comment'>-- @since 2.7.0.0</span>
<a name="line-317"></a><span class='hs-definition'>forkProcessWithUnmask</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessID</span>
<a name="line-318"></a><span class='hs-definition'>forkProcessWithUnmask</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>forkProcess</span> <span class='hs-layout'>(</span><span class='hs-varid'>action</span> <span class='hs-varid'>unsafeUnmask</span><span class='hs-layout'>)</span>
<a name="line-319"></a>
<a name="line-320"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-321"></a><span class='hs-comment'>-- Waiting for process termination</span>
<a name="line-322"></a>
<a name="line-323"></a><a name="getProcessStatus"></a><span class='hs-comment'>-- | @'getProcessStatus' blk stopped pid@ calls @waitpid@, returning</span>
<a name="line-324"></a><span class='hs-comment'>--   @'Just' tc@, the 'ProcessStatus' for process @pid@ if it is</span>
<a name="line-325"></a><span class='hs-comment'>--   available, 'Nothing' otherwise.  If @blk@ is 'False', then</span>
<a name="line-326"></a><span class='hs-comment'>--   @WNOHANG@ is set in the options for @waitpid@, otherwise not.</span>
<a name="line-327"></a><span class='hs-comment'>--   If @stopped@ is 'True', then @WUNTRACED@ is set in the</span>
<a name="line-328"></a><span class='hs-comment'>--   options for @waitpid@, otherwise not.</span>
<a name="line-329"></a><span class='hs-definition'>getProcessStatus</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>ProcessStatus</span><span class='hs-layout'>)</span>
<a name="line-330"></a><span class='hs-definition'>getProcessStatus</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span>
<a name="line-331"></a>  <span class='hs-varid'>alloca</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>wstatp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-332"></a>    <span class='hs-varid'>pid'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1Retry</span> <span class='hs-str'>"getProcessStatus"</span>
<a name="line-333"></a>                <span class='hs-layout'>(</span><span class='hs-varid'>c_waitpid</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>wstatp</span> <span class='hs-layout'>(</span><span class='hs-varid'>waitOptions</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-334"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>pid'</span> <span class='hs-keyword'>of</span>
<a name="line-335"></a>      <span class='hs-num'>0</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-336"></a>      <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>ps</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readWaitStatus</span> <span class='hs-varid'>wstatp</span>
<a name="line-337"></a>               <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>
<a name="line-338"></a>
<a name="line-339"></a><span class='hs-comment'>-- safe/interruptible, because this call might block</span>
<a name="line-340"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-varid'>interruptible</span> <span class='hs-str'>"waitpid"</span>
<a name="line-341"></a>  <span class='hs-varid'>c_waitpid</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CPid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>CPid</span>
<a name="line-342"></a>
<a name="line-343"></a><a name="getGroupProcessStatus"></a><span class='hs-comment'>-- | @'getGroupProcessStatus' blk stopped pgid@ calls @waitpid@,</span>
<a name="line-344"></a><span class='hs-comment'>--   returning @'Just' (pid, tc)@, the 'ProcessID' and 'ProcessStatus'</span>
<a name="line-345"></a><span class='hs-comment'>--   for any process in group @pgid@ if one is available, or 'Nothing'</span>
<a name="line-346"></a><span class='hs-comment'>--   if there are child processes but none have exited.  If there are</span>
<a name="line-347"></a><span class='hs-comment'>--   no child processes, then 'getGroupProcessStatus' raises an</span>
<a name="line-348"></a><span class='hs-comment'>--   'isDoesNotExistError' exception.</span>
<a name="line-349"></a><span class='hs-comment'>--</span>
<a name="line-350"></a><span class='hs-comment'>--   If @blk@ is 'False', then @WNOHANG@ is set in the options for</span>
<a name="line-351"></a><span class='hs-comment'>--   @waitpid@, otherwise not.  If @stopped@ is 'True', then</span>
<a name="line-352"></a><span class='hs-comment'>--   @WUNTRACED@ is set in the options for @waitpid@, otherwise not.</span>
<a name="line-353"></a><span class='hs-definition'>getGroupProcessStatus</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-354"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-355"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-356"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ProcessID</span><span class='hs-layout'>,</span> <span class='hs-conid'>ProcessStatus</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-357"></a><span class='hs-definition'>getGroupProcessStatus</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span> <span class='hs-varid'>pgid</span> <span class='hs-keyglyph'>=</span>
<a name="line-358"></a>  <span class='hs-varid'>alloca</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>wstatp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-359"></a>    <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>throwErrnoIfMinus1Retry</span> <span class='hs-str'>"getGroupProcessStatus"</span>
<a name="line-360"></a>                <span class='hs-layout'>(</span><span class='hs-varid'>c_waitpid</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-varid'>pgid</span><span class='hs-layout'>)</span> <span class='hs-varid'>wstatp</span> <span class='hs-layout'>(</span><span class='hs-varid'>waitOptions</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-361"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>pid</span> <span class='hs-keyword'>of</span>
<a name="line-362"></a>      <span class='hs-num'>0</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-363"></a>      <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>ps</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readWaitStatus</span> <span class='hs-varid'>wstatp</span>
<a name="line-364"></a>               <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>pid</span><span class='hs-layout'>,</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-365"></a>
<a name="line-366"></a><a name="getAnyProcessStatus"></a><span class='hs-comment'>-- | @'getAnyProcessStatus' blk stopped@ calls @waitpid@, returning</span>
<a name="line-367"></a><span class='hs-comment'>--   @'Just' (pid, tc)@, the 'ProcessID' and 'ProcessStatus' for any</span>
<a name="line-368"></a><span class='hs-comment'>--   child process if a child process has exited, or 'Nothing' if</span>
<a name="line-369"></a><span class='hs-comment'>--   there are child processes but none have exited.  If there are no</span>
<a name="line-370"></a><span class='hs-comment'>--   child processes, then 'getAnyProcessStatus' raises an</span>
<a name="line-371"></a><span class='hs-comment'>--   'isDoesNotExistError' exception.</span>
<a name="line-372"></a><span class='hs-comment'>--</span>
<a name="line-373"></a><span class='hs-comment'>--   If @blk@ is 'False', then @WNOHANG@ is set in the options for</span>
<a name="line-374"></a><span class='hs-comment'>--   @waitpid@, otherwise not.  If @stopped@ is 'True', then</span>
<a name="line-375"></a><span class='hs-comment'>--   @WUNTRACED@ is set in the options for @waitpid@, otherwise not.</span>
<a name="line-376"></a><span class='hs-definition'>getAnyProcessStatus</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ProcessID</span><span class='hs-layout'>,</span> <span class='hs-conid'>ProcessStatus</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-377"></a><span class='hs-definition'>getAnyProcessStatus</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getGroupProcessStatus</span> <span class='hs-varid'>block</span> <span class='hs-varid'>stopped</span> <span class='hs-num'>1</span>
<a name="line-378"></a>
<a name="line-379"></a><a name="waitOptions"></a><span class='hs-definition'>waitOptions</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CInt</span>
<a name="line-380"></a><span class='hs-comment'>--             block   stopped</span>
<a name="line-381"></a><span class='hs-definition'>waitOptions</span> <span class='hs-conid'>False</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-382"></a><span class='hs-comment'>{-# LINE 370 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-383"></a><span class='hs-definition'>waitOptions</span> <span class='hs-conid'>False</span> <span class='hs-conid'>True</span>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-layout'>)</span>
<a name="line-384"></a><span class='hs-comment'>{-# LINE 371 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-385"></a><span class='hs-definition'>waitOptions</span> <span class='hs-conid'>True</span>  <span class='hs-conid'>False</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-386"></a><span class='hs-definition'>waitOptions</span> <span class='hs-conid'>True</span>  <span class='hs-conid'>True</span>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-387"></a><span class='hs-comment'>{-# LINE 373 "libraries/unix/System/Posix/Process/Common.hsc" #-}</span>
<a name="line-388"></a>
<a name="line-389"></a><span class='hs-comment'>-- Turn a (ptr to a) wait status into a ProcessStatus</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="readWaitStatus"></a><span class='hs-definition'>readWaitStatus</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessStatus</span>
<a name="line-392"></a><span class='hs-definition'>readWaitStatus</span> <span class='hs-varid'>wstatp</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-393"></a>  <span class='hs-varid'>wstat</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>peek</span> <span class='hs-varid'>wstatp</span>
<a name="line-394"></a>  <span class='hs-varid'>decipherWaitStatus</span> <span class='hs-varid'>wstat</span>
<a name="line-395"></a>
<a name="line-396"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-397"></a><span class='hs-comment'>-- Exiting</span>
<a name="line-398"></a>
<a name="line-399"></a><a name="exitImmediately"></a><span class='hs-comment'>-- | @'exitImmediately' status@ calls @_exit@ to terminate the process</span>
<a name="line-400"></a><span class='hs-comment'>--   with the indicated exit @status@.</span>
<a name="line-401"></a><span class='hs-comment'>--   The operation never returns.</span>
<a name="line-402"></a><span class='hs-definition'>exitImmediately</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExitCode</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-403"></a><span class='hs-definition'>exitImmediately</span> <span class='hs-varid'>exitcode</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c_exit</span> <span class='hs-layout'>(</span><span class='hs-varid'>exitcode2Int</span> <span class='hs-varid'>exitcode</span><span class='hs-layout'>)</span>
<a name="line-404"></a>  <span class='hs-keyword'>where</span>
<a name="line-405"></a>    <span class='hs-varid'>exitcode2Int</span> <span class='hs-conid'>ExitSuccess</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-406"></a>    <span class='hs-varid'>exitcode2Int</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExitFailure</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>n</span>
<a name="line-407"></a>
<a name="line-408"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"exit"</span>
<a name="line-409"></a>  <span class='hs-varid'>c_exit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-410"></a>
<a name="line-411"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-412"></a><span class='hs-comment'>-- Deprecated or subject to change</span>
<a name="line-413"></a>
<a name="line-414"></a><span class='hs-comment'>{-# DEPRECATED createProcessGroup "This function is scheduled to be replaced by something different in the future, we therefore recommend that you do not use this version and use 'createProcessGroupFor' instead." #-}</span> <span class='hs-comment'>-- deprecated in 7.2</span>
<a name="line-415"></a><a name="createProcessGroup"></a><span class='hs-comment'>-- | @'createProcessGroup' pid@ calls @setpgid@ to make</span>
<a name="line-416"></a><span class='hs-comment'>--   process @pid@ a new process group leader.</span>
<a name="line-417"></a><span class='hs-comment'>--   This function is currently deprecated,</span>
<a name="line-418"></a><span class='hs-comment'>--   and might be changed to making the current</span>
<a name="line-419"></a><span class='hs-comment'>--   process a new process group leader in future versions.</span>
<a name="line-420"></a><span class='hs-definition'>createProcessGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ProcessGroupID</span>
<a name="line-421"></a><span class='hs-definition'>createProcessGroup</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-422"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"createProcessGroup"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_setpgid</span> <span class='hs-varid'>pid</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-423"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>pid</span>
<a name="line-424"></a>
<a name="line-425"></a><span class='hs-comment'>{-# DEPRECATED setProcessGroupID "This function is scheduled to be replaced by something different in the future, we therefore recommend that you do not use this version and use 'setProcessGroupIDOf' instead." #-}</span> <span class='hs-comment'>-- deprecated in 7.2</span>
<a name="line-426"></a><a name="setProcessGroupID"></a><span class='hs-comment'>-- | @'setProcessGroupID' pid pgid@ calls @setpgid@ to set the</span>
<a name="line-427"></a><span class='hs-comment'>--   'ProcessGroupID' for process @pid@ to @pgid@.</span>
<a name="line-428"></a><span class='hs-comment'>--   This function is currently deprecated,</span>
<a name="line-429"></a><span class='hs-comment'>--   and might be changed to setting the 'ProcessGroupID'</span>
<a name="line-430"></a><span class='hs-comment'>--   for the current process in future versions.</span>
<a name="line-431"></a><span class='hs-definition'>setProcessGroupID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProcessID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ProcessGroupID</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-432"></a><span class='hs-definition'>setProcessGroupID</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>pgid</span> <span class='hs-keyglyph'>=</span>
<a name="line-433"></a>  <span class='hs-varid'>throwErrnoIfMinus1_</span> <span class='hs-str'>"setProcessGroupID"</span> <span class='hs-layout'>(</span><span class='hs-varid'>c_setpgid</span> <span class='hs-varid'>pid</span> <span class='hs-varid'>pgid</span><span class='hs-layout'>)</span>
<a name="line-434"></a>
<a name="line-435"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
</pre></body>
</html>
