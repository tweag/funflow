<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE EmptyCase #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- This module is not exposed. The reason that it is split out from</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- &quot;Data.Store.Internal&quot; is to allow &quot;Data.Store.TH&quot; to refer to these</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- identifiers. &quot;Data.Store.Internal&quot; must be separate from</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- &quot;Data.Store.TH&quot; due to Template Haskell's stage restriction.</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Store.Impl</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Functor.Contravariant</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Contravariant</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Store.Core</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeRep</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Storable</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sizeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Constraint</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- Store class</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | The 'Store' typeclass provides efficient serialization and</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- deserialization to raw pointer addresses.</span><span>
</span><span id="line-44"></span><span class="hs-comment">--</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- The 'peek' and 'poke' methods should be defined such that</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- @ decodeEx (encode x) == x @.</span><span>
</span><span id="line-47"></span><span class="hs-keyword">class</span><span> </span><span id="Store"><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-var">Store</span></a></span></span><span> </span><span id="local-6989586621679538317"><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-comment">-- | Yields the 'Size' of the buffer, in bytes, required to store</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-comment">-- the encoded representation of the type.</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-comment">-- Note that the correctness of this function is crucial for the</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-comment">-- safety of 'poke', as it does not do any bounds checking. It is</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- the responsibility of the invoker of 'poke' ('encode' and similar</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- functions) to ensure that there's enough space in the output</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- buffer. If 'poke' writes beyond, then arbitrary memory can be</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- overwritten, causing undefined behavior and segmentation faults.</span><span>
</span><span id="line-57"></span><span>    </span><span id="size"><span class="annot"><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-type">size</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- | Serializes a value to bytes. It is the responsibility of the</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- caller to ensure that at least the number of bytes required by</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">-- 'size' are available. These details are handled by 'encode' and</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- similar utilities.</span><span>
</span><span id="line-62"></span><span>    </span><span id="poke"><span class="annot"><a href="Data.Store.Impl.html#poke"><span class="hs-identifier hs-type">poke</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Poke</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">-- | Serialized a value from bytes, throwing exceptions if it</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- encounters invalid data or runs out of input bytes.</span><span>
</span><span id="line-65"></span><span>    </span><span id="peek"><span class="annot"><a href="Data.Store.Impl.html#peek"><span class="hs-identifier hs-type">peek</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">default</span><span> </span><span id="size"><span class="annot"><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-type">size</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621679538090"><span class="annot"><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-var hs-var">size</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Size a
forall a. (Generic a, GStoreSize (Rep a)) =&gt; Size a
</span><a href="Data.Store.Impl.html#genericSize"><span class="hs-identifier hs-var">genericSize</span></a></span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">default</span><span> </span><span id="poke"><span class="annot"><a href="Data.Store.Impl.html#poke"><span class="hs-identifier hs-type">poke</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Poke</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679538088"><span class="annot"><a href="Data.Store.Impl.html#poke"><span class="hs-identifier hs-var hs-var">poke</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Poke ()
forall a. (Generic a, GStorePoke (Rep a)) =&gt; a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#genericPoke"><span class="hs-identifier hs-var">genericPoke</span></a></span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-keyword">default</span><span> </span><span id="peek"><span class="annot"><a href="Data.Store.Impl.html#peek"><span class="hs-identifier hs-type">peek</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679538317"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679538086"><span class="annot"><a href="Data.Store.Impl.html#peek"><span class="hs-identifier hs-var hs-var">peek</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Peek a
forall a. (Generic a, GStorePeek (Rep a)) =&gt; Peek a
</span><a href="Data.Store.Impl.html#genericPeek"><span class="hs-identifier hs-var">genericPeek</span></a></span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- NB: Do not INLINE the default implementations of size, poke, or peek!</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- Doing so can lead to enormous memory blowup (a maximum residency of</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- 5.17 GB with GHC 8.0.2 has been observed). For more information, please</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- read issue #91.</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- Utilities for encoding / decoding strict ByteStrings</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Serializes a value to a 'BS.ByteString'. In order to do this, it</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- first allocates a 'BS.ByteString' of the correct size (based on</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- 'size'), and then uses 'poke' to fill it.</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Safety of this function depends on correctness of the 'Store'</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- instance. If 'size' returns a. The good news is that this isn't an</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- issue if you use well-tested manual instances (such as those from</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- this package) combined with auomatic definition of instances.</span><span>
</span><span id="line-92"></span><span id="local-6989586621679538084"><span class="annot"><a href="Data.Store.Impl.html#encode"><span class="hs-identifier hs-type">encode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538084"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538084"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span></span><span>
</span><span id="line-93"></span><span id="encode"><span class="annot"><span class="annottext">encode :: a -&gt; ByteString
</span><a href="Data.Store.Impl.html#encode"><span class="hs-identifier hs-var hs-var">encode</span></a></span></span><span> </span><span id="local-6989586621679538082"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538082"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Poke () -&gt; Int -&gt; ByteString
</span><span class="hs-identifier hs-var">unsafeEncodeWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Poke ()
forall a. Store a =&gt; a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#poke"><span class="hs-identifier hs-var">poke</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538082"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int
forall a. Store a =&gt; a -&gt; Int
</span><a href="Data.Store.Impl.html#getSize"><span class="hs-identifier hs-var">getSize</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538082"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | Decodes a value from a 'BS.ByteString'. Returns an exception if</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- there's an error while decoding, or if decoding undershoots /</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- overshoots the end of the buffer.</span><span>
</span><span id="line-98"></span><span id="local-6989586621679538079"><span class="annot"><a href="Data.Store.Impl.html#decode"><span class="hs-identifier hs-type">decode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538079"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeekException</span></span><span> </span><span class="annot"><a href="#local-6989586621679538079"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-99"></span><span id="decode"><span class="annot"><span class="annottext">decode :: ByteString -&gt; Either PeekException a
</span><a href="Data.Store.Impl.html#decode"><span class="hs-identifier hs-var hs-var">decode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either PeekException a) -&gt; Either PeekException a
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either PeekException a) -&gt; Either PeekException a)
-&gt; (ByteString -&gt; IO (Either PeekException a))
-&gt; ByteString
-&gt; Either PeekException a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either PeekException a)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Either PeekException a))
-&gt; (ByteString -&gt; IO a)
-&gt; ByteString
-&gt; IO (Either PeekException a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO a
forall a. Store a =&gt; ByteString -&gt; IO a
</span><a href="Data.Store.Impl.html#decodeIO"><span class="hs-identifier hs-var">decodeIO</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Decodes a value from a 'BS.ByteString', potentially throwing</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- exceptions. It is an exception to not consume all input.</span><span>
</span><span id="line-103"></span><span id="local-6989586621679538075"><span class="annot"><a href="Data.Store.Impl.html#decodeEx"><span class="hs-identifier hs-type">decodeEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538075"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538075"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-104"></span><span id="decodeEx"><span class="annot"><span class="annottext">decodeEx :: ByteString -&gt; a
</span><a href="Data.Store.Impl.html#decodeEx"><span class="hs-identifier hs-var hs-var">decodeEx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; a
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; a) -&gt; (ByteString -&gt; IO a) -&gt; ByteString -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO a
forall a. Store a =&gt; ByteString -&gt; IO a
</span><a href="Data.Store.Impl.html#decodeIO"><span class="hs-identifier hs-var">decodeIO</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- | Decodes a value from a 'BS.ByteString', potentially throwing</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- exceptions. It is an exception to not consume all input.</span><span>
</span><span id="line-108"></span><span id="local-6989586621679538294"><span class="annot"><a href="Data.Store.Impl.html#decodeIO"><span class="hs-identifier hs-type">decodeIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538294"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679538294"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span id="decodeIO"><span class="annot"><span class="annottext">decodeIO :: ByteString -&gt; IO a
</span><a href="Data.Store.Impl.html#decodeIO"><span class="hs-identifier hs-var hs-var">decodeIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Peek a -&gt; ByteString -&gt; IO a
forall a. Peek a -&gt; ByteString -&gt; IO a
</span><span class="hs-identifier hs-var">decodeIOWith</span></span><span> </span><span class="annot"><span class="annottext">Peek a
forall a. Store a =&gt; Peek a
</span><a href="Data.Store.Impl.html#peek"><span class="hs-identifier hs-var">peek</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- Size</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Info about a type's serialized length. Either the length is known</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- independently of the value, or the length depends on the value.</span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="Size"><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-var">Size</span></a></span></span><span> </span><span id="local-6989586621679538280"><span class="annot"><a href="#local-6989586621679538280"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="VarSize"><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538280"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ConstSize"><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679538068"><span class="annot"><span class="hs-identifier hs-type">Contravariant</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621679538066"><span class="annot"><span class="annottext">contramap :: (a -&gt; b) -&gt; Size b -&gt; Size a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">contramap</span></span></span><span> </span><span id="local-6989586621679538064"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679538064"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679538063"><span class="annot"><span class="annottext">Size b
</span><a href="#local-6989586621679538063"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Size b
</span><a href="#local-6989586621679538063"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538062"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538062"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size a
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538062"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538061"><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538061"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Int) -&gt; Size a
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679538060"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538060"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538061"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679538064"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538060"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Get the number of bytes needed to store the given value. See</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- 'size'.</span><span>
</span><span id="line-128"></span><span id="local-6989586621679538304"><span class="annot"><a href="Data.Store.Impl.html#getSize"><span class="hs-identifier hs-type">getSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538304"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538304"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-129"></span><span id="getSize"><span class="annot"><span class="annottext">getSize :: a -&gt; Int
</span><a href="Data.Store.Impl.html#getSize"><span class="hs-identifier hs-var hs-var">getSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Size a -&gt; a -&gt; Int
forall a. Size a -&gt; a -&gt; Int
</span><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-identifier hs-var">getSizeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Size a
forall a. Store a =&gt; Size a
</span><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-130"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#getSize"><span class="hs-pragma hs-type">getSize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Given a 'Size' value and a value of the type @a@, returns its 'Int'</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- size.</span><span>
</span><span id="line-134"></span><span id="local-6989586621679538278"><span class="annot"><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-identifier hs-type">getSizeWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538278"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538278"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-135"></span><span id="getSizeWith"><span class="annot"><span class="annottext">getSizeWith :: Size a -&gt; a -&gt; Int
</span><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-identifier hs-var hs-var">getSizeWith</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538058"><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538058"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679538057"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538057"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538058"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679538057"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-identifier hs-var">getSizeWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538056"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538056"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538056"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-137"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-pragma hs-type">getSizeWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- | Create an aggregate 'Size' by providing functions to split the</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- input into two pieces.</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- If both of the types are 'ConstSize', the result is 'ConstSize' and</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- the functions will not be used.</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Data.Store.Impl.html#combineSize"><span class="hs-identifier hs-type">combineSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679538054"><span class="annot"><a href="#local-6989586621679538054"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679538053"><span class="annot"><a href="#local-6989586621679538053"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679538052"><span class="annot"><a href="#local-6989586621679538052"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538053"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538052"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538052"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538053"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538052"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-145"></span><span id="combineSize"><span class="annot"><span class="annottext">combineSize :: (c -&gt; a) -&gt; (c -&gt; b) -&gt; Size c
</span><a href="Data.Store.Impl.html#combineSize"><span class="hs-identifier hs-var hs-var">combineSize</span></a></span></span><span> </span><span id="local-6989586621679538051"><span class="annot"><span class="annottext">c -&gt; a
</span><a href="#local-6989586621679538051"><span class="hs-identifier hs-var">toA</span></a></span></span><span> </span><span id="local-6989586621679538050"><span class="annot"><span class="annottext">c -&gt; b
</span><a href="#local-6989586621679538050"><span class="hs-identifier hs-var">toB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(c -&gt; a) -&gt; (c -&gt; b) -&gt; Size a -&gt; Size b -&gt; Size c
forall a b c. (c -&gt; a) -&gt; (c -&gt; b) -&gt; Size a -&gt; Size b -&gt; Size c
</span><a href="Data.Store.Impl.html#combineSizeWith"><span class="hs-identifier hs-var">combineSizeWith</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; a
</span><a href="#local-6989586621679538051"><span class="hs-identifier hs-var">toA</span></a></span><span> </span><span class="annot"><span class="annottext">c -&gt; b
</span><a href="#local-6989586621679538050"><span class="hs-identifier hs-var">toB</span></a></span><span> </span><span class="annot"><span class="annottext">Size a
forall a. Store a =&gt; Size a
</span><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Size b
forall a. Store a =&gt; Size a
</span><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#combineSize"><span class="hs-pragma hs-type">combineSize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | Create an aggregate 'Size' by providing functions to split the</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- input into two pieces, as well as 'Size' values to use to measure the</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- results.</span><span>
</span><span id="line-151"></span><span class="hs-comment">--</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- If both of the input 'Size' values are 'ConstSize', the result is</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- 'ConstSize' and the functions will not be used.</span><span>
</span><span id="line-154"></span><span class="annot"><a href="Data.Store.Impl.html#combineSizeWith"><span class="hs-identifier hs-type">combineSizeWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679538272"><span class="annot"><a href="#local-6989586621679538272"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679538271"><span class="annot"><a href="#local-6989586621679538271"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679538273"><span class="annot"><a href="#local-6989586621679538273"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538273"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538272"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538273"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538271"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538272"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538271"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538273"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-155"></span><span id="combineSizeWith"><span class="annot"><span class="annottext">combineSizeWith :: (c -&gt; a) -&gt; (c -&gt; b) -&gt; Size a -&gt; Size b -&gt; Size c
</span><a href="Data.Store.Impl.html#combineSizeWith"><span class="hs-identifier hs-var hs-var">combineSizeWith</span></a></span></span><span> </span><span id="local-6989586621679538048"><span class="annot"><span class="annottext">c -&gt; a
</span><a href="#local-6989586621679538048"><span class="hs-identifier hs-var">toA</span></a></span></span><span> </span><span id="local-6989586621679538047"><span class="annot"><span class="annottext">c -&gt; b
</span><a href="#local-6989586621679538047"><span class="hs-identifier hs-var">toB</span></a></span></span><span> </span><span id="local-6989586621679538046"><span class="annot"><span class="annottext">Size a
</span><a href="#local-6989586621679538046"><span class="hs-identifier hs-var">sizeA</span></a></span></span><span> </span><span id="local-6989586621679538045"><span class="annot"><span class="annottext">Size b
</span><a href="#local-6989586621679538045"><span class="hs-identifier hs-var">sizeB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Size a
</span><a href="#local-6989586621679538046"><span class="hs-identifier hs-var">sizeA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Size b
</span><a href="#local-6989586621679538045"><span class="hs-identifier hs-var">sizeB</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538044"><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538044"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538043"><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538043"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(c -&gt; Int) -&gt; Size c
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679538042"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538042"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538044"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c -&gt; a
</span><a href="#local-6989586621679538048"><span class="hs-identifier hs-var">toA</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538042"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538043"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c -&gt; b
</span><a href="#local-6989586621679538047"><span class="hs-identifier hs-var">toB</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538042"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538040"><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538040"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538039"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538039"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(c -&gt; Int) -&gt; Size c
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679538038"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538038"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538040"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c -&gt; a
</span><a href="#local-6989586621679538048"><span class="hs-identifier hs-var">toA</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538038"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538039"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538037"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538037"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538036"><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538036"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(c -&gt; Int) -&gt; Size c
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679538035"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538035"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538037"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Int
</span><a href="#local-6989586621679538036"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">c -&gt; b
</span><a href="#local-6989586621679538047"><span class="hs-identifier hs-var">toB</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679538035"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538034"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538034"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538033"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538033"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size c
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538034"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538033"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#combineSizeWith"><span class="hs-pragma hs-type">combineSizeWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Adds a constant amount to a 'Size' value.</span><span>
</span><span id="line-164"></span><span id="local-6989586621679538032"><span class="annot"><a href="Data.Store.Impl.html#addSize"><span class="hs-identifier hs-type">addSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538032"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538032"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-165"></span><span id="addSize"><span class="annot"><span class="annottext">addSize :: Int -&gt; Size a -&gt; Size a
</span><a href="Data.Store.Impl.html#addSize"><span class="hs-identifier hs-var hs-var">addSize</span></a></span></span><span> </span><span id="local-6989586621679538030"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538030"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-type">ConstSize</span></a></span><span> </span><span id="local-6989586621679538029"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538029"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size a
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538030"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538029"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="annot"><a href="Data.Store.Impl.html#addSize"><span class="hs-identifier hs-var">addSize</span></a></span><span> </span><span id="local-6989586621679538028"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538028"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-type">VarSize</span></a></span><span> </span><span id="local-6989586621679538027"><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538027"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Int) -&gt; Size a
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679538028"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (a -&gt; Int) -&gt; a -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int
</span><a href="#local-6989586621679538027"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#addSize"><span class="hs-pragma hs-type">addSize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- | A 'size' implementation based on an instance of 'Storable' and</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- 'Typeable'.</span><span>
</span><span id="line-171"></span><span class="annot"><a href="Data.Store.Impl.html#sizeStorable"><span class="hs-identifier hs-type">sizeStorable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679538025"><span class="annot"><a href="#local-6989586621679538025"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Storable</span></span><span> </span><span class="annot"><a href="#local-6989586621679538025"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679538025"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538025"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-172"></span><span id="sizeStorable"><span class="annot"><span class="annottext">sizeStorable :: Size a
</span><a href="Data.Store.Impl.html#sizeStorable"><span class="hs-identifier hs-var hs-var">sizeStorable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Size a
forall a. Storable a =&gt; String -&gt; Size a
</span><a href="Data.Store.Impl.html#sizeStorableTy"><span class="hs-identifier hs-var">sizeStorableTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeRep -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a -&gt; TypeRep
forall k (proxy :: k -&gt; *) (a :: k).
Typeable a =&gt;
proxy a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeRep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679538025"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#sizeStorable"><span class="hs-pragma hs-type">sizeStorable</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | A 'size' implementation based on an instance of 'Storable'. Use this</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- if the type is not 'Typeable'.</span><span>
</span><span id="line-177"></span><span class="annot"><a href="Data.Store.Impl.html#sizeStorableTy"><span class="hs-identifier hs-type">sizeStorableTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679538263"><span class="annot"><a href="#local-6989586621679538263"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Storable</span></span><span> </span><span class="annot"><a href="#local-6989586621679538263"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538263"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-178"></span><span id="sizeStorableTy"><span class="annot"><span class="annottext">sizeStorableTy :: String -&gt; Size a
</span><a href="Data.Store.Impl.html#sizeStorableTy"><span class="hs-identifier hs-var hs-var">sizeStorableTy</span></a></span></span><span> </span><span id="local-6989586621679538021"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679538021"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size a
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679538019"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679538263"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679538019"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621679538019"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In Data.Store.storableSize: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679538021"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'s sizeOf evaluated its argument.&quot;</span></span><span>
</span><span id="line-181"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#sizeStorableTy"><span class="hs-pragma hs-type">sizeStorableTy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- Generics</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621679538315"><span class="annot"><a href="Data.Store.Impl.html#genericSize"><span class="hs-identifier hs-type">genericSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538315"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538315"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538315"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-187"></span><span id="genericSize"><span class="annot"><span class="annottext">genericSize :: Size a
</span><a href="Data.Store.Impl.html#genericSize"><span class="hs-identifier hs-var hs-var">genericSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Rep a Any) -&gt; Size (Rep a Any) -&gt; Size a
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Rep a Any
forall a x. Generic a =&gt; a -&gt; Rep a x
</span><span class="hs-identifier hs-var">from</span></span><span> </span><span class="annot"><span class="annottext">Size (Rep a Any)
forall (f :: * -&gt; *) a. GStoreSize f =&gt; Size (f a)
</span><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-var">gsize</span></a></span><span>
</span><span id="line-188"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#genericSize"><span class="hs-pragma hs-type">genericSize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span id="local-6989586621679538312"><span class="annot"><a href="Data.Store.Impl.html#genericPoke"><span class="hs-identifier hs-type">genericPoke</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538312"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538312"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679538312"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Poke</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-191"></span><span id="genericPoke"><span class="annot"><span class="annottext">genericPoke :: a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#genericPoke"><span class="hs-identifier hs-var hs-var">genericPoke</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rep a Any -&gt; Poke ()
forall (f :: * -&gt; *) a. GStorePoke f =&gt; f a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-var">gpoke</span></a></span><span> </span><span class="annot"><span class="annottext">(Rep a Any -&gt; Poke ()) -&gt; (a -&gt; Rep a Any) -&gt; a -&gt; Poke ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Rep a Any
forall a x. Generic a =&gt; a -&gt; Rep a x
</span><span class="hs-identifier hs-var">from</span></span><span>
</span><span id="line-192"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#genericPoke"><span class="hs-pragma hs-type">genericPoke</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621679538309"><span class="annot"><a href="Data.Store.Impl.html#genericPeek"><span class="hs-identifier hs-type">genericPeek</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Generic</span></span><span> </span><span class="annot"><a href="#local-6989586621679538309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Rep</span></span><span> </span><span class="annot"><a href="#local-6989586621679538309"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679538309"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-195"></span><span id="genericPeek"><span class="annot"><span class="annottext">genericPeek :: Peek a
</span><a href="Data.Store.Impl.html#genericPeek"><span class="hs-identifier hs-var hs-var">genericPeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rep a Any -&gt; a
forall a x. Generic a =&gt; Rep a x -&gt; a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">(Rep a Any -&gt; a) -&gt; Peek (Rep a Any) -&gt; Peek a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Peek (Rep a Any)
forall (f :: * -&gt; *) a. GStorePeek f =&gt; Peek (f a)
</span><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-var">gpeek</span></a></span><span>
</span><span id="line-196"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#genericPeek"><span class="hs-pragma hs-type">genericPeek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="SumArity"><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-var">SumArity</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538012"><span class="annot"><a href="#local-6989586621679538012"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span id="SumArity"><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-var">SumArity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C1</span></span><span> </span><span id="local-6989586621679538011"><span class="annot"><a href="#local-6989586621679538011"><span class="hs-identifier hs-type hs-type">c</span></a></span></span><span> </span><span id="local-6989586621679538010"><span class="annot"><a href="#local-6989586621679538010"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-200"></span><span>    </span><span id="SumArity"><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-var">SumArity</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538009"><span class="annot"><a href="#local-6989586621679538009"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span id="local-6989586621679538008"><span class="annot"><a href="#local-6989586621679538008"><span class="hs-identifier hs-type hs-type">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538009"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538008"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- This could be just one typeclass, but currently compile times are</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- better with things split up.</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- https://github.com/bos/aeson/pull/335</span><span>
</span><span id="line-205"></span><span class="hs-comment">--</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-keyword">class</span><span> </span><span id="GStoreSize"><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-var">GStoreSize</span></a></span></span><span> </span><span id="local-6989586621679538244"><span class="annot"><a href="#local-6989586621679538244"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538243"><span id="gsize"><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-type">gsize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538244"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538243"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-208"></span><span class="hs-keyword">class</span><span> </span><span id="GStorePoke"><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-var">GStorePoke</span></a></span></span><span> </span><span id="local-6989586621679538241"><span class="annot"><a href="#local-6989586621679538241"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538240"><span id="gpoke"><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-type">gpoke</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679538241"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Poke</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-209"></span><span class="hs-keyword">class</span><span> </span><span id="GStorePeek"><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-var">GStorePeek</span></a></span></span><span> </span><span id="local-6989586621679538234"><span class="annot"><a href="#local-6989586621679538234"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538233"><span id="gpeek"><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-type">gpeek</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538234"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538233"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621679538005"><span id="local-6989586621679538006"><span id="local-6989586621679538007"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538007"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M1</span></span><span> </span><span class="annot"><a href="#local-6989586621679538006"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538005"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538007"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679538002"><span class="annot"><span class="annottext">gsize :: Size (M1 i c f a)
</span><a href="#local-6989586621679538002"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(M1 i c f a -&gt; f a) -&gt; Size (f a) -&gt; Size (M1 i c f a)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="annot"><span class="annottext">M1 i c f a -&gt; f a
forall i (c :: Meta) k (f :: k -&gt; *) (p :: k). M1 i c f p -&gt; f p
</span><span class="hs-identifier hs-var hs-var">unM1</span></span><span> </span><span class="annot"><span class="annottext">Size (f a)
forall (f :: * -&gt; *) a. GStoreSize f =&gt; Size (f a)
</span><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-var">gsize</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-214"></span><span id="local-6989586621679537998"><span id="local-6989586621679537999"><span id="local-6989586621679538000"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538000"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537999"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537998"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538000"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679537995"><span class="annot"><span class="annottext">gpoke :: M1 i c f a -&gt; Poke ()
</span><a href="#local-6989586621679537995"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f a -&gt; Poke ()
forall (f :: * -&gt; *) a. GStorePoke f =&gt; f a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-var">gpoke</span></a></span><span> </span><span class="annot"><span class="annottext">(f a -&gt; Poke ()) -&gt; (M1 i c f a -&gt; f a) -&gt; M1 i c f a -&gt; Poke ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">M1 i c f a -&gt; f a
forall i (c :: Meta) k (f :: k -&gt; *) (p :: k). M1 i c f p -&gt; f p
</span><span class="hs-identifier hs-var hs-var">unM1</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-217"></span><span id="local-6989586621679537992"><span id="local-6989586621679537993"><span id="local-6989586621679537994"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537994"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537993"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537992"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537994"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621679537989"><span class="annot"><span class="annottext">gpeek :: Peek (M1 i c f a)
</span><a href="#local-6989586621679537989"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(f a -&gt; M1 i c f a) -&gt; Peek (f a) -&gt; Peek (M1 i c f a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">f a -&gt; M1 i c f a
forall k i (c :: Meta) (f :: k -&gt; *) (p :: k). f p -&gt; M1 i c f p
</span><span class="hs-identifier hs-var">M1</span></span><span> </span><span class="annot"><span class="annottext">Peek (f a)
forall (f :: * -&gt; *) a. GStorePeek f =&gt; Peek (f a)
</span><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-var">gpeek</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621679537986"><span id="local-6989586621679537987"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537986"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537987"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621679537984"><span class="annot"><span class="annottext">gsize :: Size (K1 i a a)
</span><a href="#local-6989586621679537984"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(K1 i a a -&gt; a) -&gt; Size a -&gt; Size (K1 i a a)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span> </span><span class="annot"><span class="annottext">K1 i a a -&gt; a
forall i c k (p :: k). K1 i c p -&gt; c
</span><span class="hs-identifier hs-var hs-var">unK1</span></span><span> </span><span class="annot"><span class="annottext">Size a
forall a. Store a =&gt; Size a
</span><a href="Data.Store.Impl.html#size"><span class="hs-identifier hs-var">size</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-224"></span><span id="local-6989586621679537981"><span id="local-6989586621679537982"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537982"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537981"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537982"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679537979"><span class="annot"><span class="annottext">gpoke :: K1 i a a -&gt; Poke ()
</span><a href="#local-6989586621679537979"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Poke ()
forall a. Store a =&gt; a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#poke"><span class="hs-identifier hs-var">poke</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Poke ()) -&gt; (K1 i a a -&gt; a) -&gt; K1 i a a -&gt; Poke ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">K1 i a a -&gt; a
forall i c k (p :: k). K1 i c p -&gt; c
</span><span class="hs-identifier hs-var hs-var">unK1</span></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-227"></span><span id="local-6989586621679537977"><span id="local-6989586621679537978"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#Store"><span class="hs-identifier hs-type">Store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537978"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537977"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537978"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679537975"><span class="annot"><span class="annottext">gpeek :: Peek (K1 i a a)
</span><a href="#local-6989586621679537975"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; K1 i a a) -&gt; Peek a -&gt; Peek (K1 i a a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; K1 i a a
forall k i c (p :: k). c -&gt; K1 i c p
</span><span class="hs-identifier hs-var">K1</span></span><span> </span><span class="annot"><span class="annottext">Peek a
forall a. Store a =&gt; Peek a
</span><a href="Data.Store.Impl.html#peek"><span class="hs-identifier hs-var">peek</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">U1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679537972"><span class="annot"><span class="annottext">gsize :: Size (U1 a)
</span><a href="#local-6989586621679537972"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size (U1 a)
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-234"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">U1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679537970"><span class="annot"><span class="annottext">gpoke :: U1 a -&gt; Poke ()
</span><a href="#local-6989586621679537970"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span class="annot"><span class="annottext">U1 a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Poke ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-237"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">U1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679537968"><span class="annot"><span class="annottext">gpeek :: Peek (U1 a)
</span><a href="#local-6989586621679537968"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U1 a -&gt; Peek (U1 a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">U1 a
forall k (p :: k). U1 p
</span><span class="hs-identifier hs-var">U1</span></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679537965"><span class="annot"><span class="annottext">gsize :: Size (V1 a)
</span><a href="#local-6989586621679537965"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Size (V1 a)
forall a. Int -&gt; Size a
</span><a href="Data.Store.Impl.html#ConstSize"><span class="hs-identifier hs-var">ConstSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-244"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621679537963"><span class="annot"><span class="annottext">gpoke :: V1 a -&gt; Poke ()
</span><a href="#local-6989586621679537963"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span id="local-6989586621679537962"><span class="annot"><span class="annottext">V1 a
</span><a href="#local-6989586621679537962"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">V1 a
</span><a href="#local-6989586621679537962"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-247"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">V1</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679537960"><span class="annot"><span class="annottext">gpeek :: Peek (V1 a)
</span><a href="#local-6989586621679537960"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Peek (V1 a)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621679537957"><span id="local-6989586621679537958"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537958"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537957"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537958"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537957"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679537955"><span class="annot"><span class="annottext">gsize :: Size ((:*:) a b a)
</span><a href="#local-6989586621679537955"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((:*:) a b a -&gt; a a)
-&gt; ((:*:) a b a -&gt; b a)
-&gt; Size (a a)
-&gt; Size (b a)
-&gt; Size ((:*:) a b a)
forall a b c. (c -&gt; a) -&gt; (c -&gt; b) -&gt; Size a -&gt; Size b -&gt; Size c
</span><a href="Data.Store.Impl.html#combineSizeWith"><span class="hs-identifier hs-var">combineSizeWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679537954"><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537954"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span class="annot"><span class="annottext">b a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537954"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span id="local-6989586621679537952"><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537952"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537952"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Size (a a)
forall (f :: * -&gt; *) a. GStoreSize f =&gt; Size (f a)
</span><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-var">gsize</span></a></span><span> </span><span class="annot"><span class="annottext">Size (b a)
forall (f :: * -&gt; *) a. GStoreSize f =&gt; Size (f a)
</span><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-var">gsize</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-254"></span><span id="local-6989586621679537950"><span id="local-6989586621679537951"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537951"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537950"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537951"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537950"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679537948"><span class="annot"><span class="annottext">gpoke :: (:*:) a b a -&gt; Poke ()
</span><a href="#local-6989586621679537948"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679537947"><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537947"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span id="local-6989586621679537946"><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537946"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a a -&gt; Poke ()
forall (f :: * -&gt; *) a. GStorePoke f =&gt; f a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-var">gpoke</span></a></span><span> </span><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537947"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Poke () -&gt; Poke () -&gt; Poke ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">b a -&gt; Poke ()
forall (f :: * -&gt; *) a. GStorePoke f =&gt; f a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-var">gpoke</span></a></span><span> </span><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537946"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-257"></span><span id="local-6989586621679537944"><span id="local-6989586621679537945"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537945"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537944"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537945"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:*:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537944"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679537942"><span class="annot"><span class="annottext">gpeek :: Peek ((:*:) a b a)
</span><a href="#local-6989586621679537942"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a a -&gt; b a -&gt; (:*:) a b a
forall k (f :: k -&gt; *) (g :: k -&gt; *) (p :: k).
f p -&gt; g p -&gt; (:*:) f g p
</span><span class="hs-operator hs-var">(:*:)</span></span><span> </span><span class="annot"><span class="annottext">(a a -&gt; b a -&gt; (:*:) a b a)
-&gt; Peek (a a) -&gt; Peek (b a -&gt; (:*:) a b a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Peek (a a)
forall (f :: * -&gt; *) a. GStorePeek f =&gt; Peek (f a)
</span><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-var">gpeek</span></a></span><span> </span><span class="annot"><span class="annottext">Peek (b a -&gt; (:*:) a b a) -&gt; Peek (b a) -&gt; Peek ((:*:) a b a)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Peek (b a)
forall (f :: * -&gt; *) a. GStorePeek f =&gt; Peek (f a)
</span><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-var">gpeek</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">-- The machinery for sum types is why UndecidableInstances is necessary.</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span id="local-6989586621679537940"><span id="local-6989586621679537941"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#FitsInByte"><span class="hs-identifier hs-type">FitsInByte</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537940"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-type">GStoreSizeSum</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537940"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537940"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679537938"><span class="annot"><span class="annottext">gsize :: Size ((:+:) a b a)
</span><a href="#local-6989586621679537938"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((:+:) a b a -&gt; Int) -&gt; Size ((:+:) a b a)
forall a. (a -&gt; Int) -&gt; Size a
</span><a href="Data.Store.Impl.html#VarSize"><span class="hs-identifier hs-var">VarSize</span></a></span><span> </span><span class="annot"><span class="annottext">(((:+:) a b a -&gt; Int) -&gt; Size ((:+:) a b a))
-&gt; ((:+:) a b a -&gt; Int) -&gt; Size ((:+:) a b a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679537937"><span class="annot"><span class="annottext">(:+:) a b a
</span><a href="#local-6989586621679537937"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">(:+:) a b a -&gt; Proxy 0 -&gt; Int
forall (n :: Nat) (f :: * -&gt; *) a.
GStoreSizeSum n f =&gt;
f a -&gt; Proxy n -&gt; Int
</span><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-identifier hs-var">gsizeSum</span></a></span><span> </span><span class="annot"><span class="annottext">(:+:) a b a
</span><a href="#local-6989586621679537937"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy 0
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsize"><span class="hs-pragma hs-type">gsize</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-267"></span><span id="local-6989586621679537934"><span id="local-6989586621679537935"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#FitsInByte"><span class="hs-identifier hs-type">FitsInByte</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537935"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537934"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-type">GStorePokeSum</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537935"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537934"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537935"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537934"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679537932"><span class="annot"><span class="annottext">gpoke :: (:+:) a b a -&gt; Poke ()
</span><a href="#local-6989586621679537932"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpoke</span></a></span></span><span> </span><span id="local-6989586621679537931"><span class="annot"><span class="annottext">(:+:) a b a
</span><a href="#local-6989586621679537931"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(:+:) a b a -&gt; Proxy 0 -&gt; Poke ()
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePokeSum n f =&gt;
f p -&gt; Proxy n -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-identifier hs-var">gpokeSum</span></a></span><span> </span><span class="annot"><span class="annottext">(:+:) a b a
</span><a href="#local-6989586621679537931"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy 0
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpoke"><span class="hs-pragma hs-type">gpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-271"></span><span id="local-6989586621679537928"><span id="local-6989586621679537929"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#FitsInByte"><span class="hs-identifier hs-type">FitsInByte</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537929"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-type">GStorePeekSum</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537929"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537929"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537928"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621679537926"><span class="annot"><span class="annottext">gpeek :: Peek ((:+:) a b a)
</span><a href="#local-6989586621679537926"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeek</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621679537925"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537925"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Peek Word8
forall a. (Storable a, Typeable a) =&gt; Peek a
</span><span class="hs-identifier hs-var">peekStorable</span></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Word8 -&gt; Proxy 0 -&gt; Peek ((:+:) a b a)
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePeekSum n f =&gt;
Word8 -&gt; Proxy n -&gt; Peek (f p)
</span><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-identifier hs-var">gpeekSum</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537925"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy 0
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeek"><span class="hs-pragma hs-type">gpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- See https://github.com/fpco/store/issues/141 - this constraint type</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- family machinery improves error messages for generic deriving on</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- sum types with many constructors.</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-keyword">type</span><span> </span><span id="FitsInByte"><span class="annot"><a href="Data.Store.Impl.html#FitsInByte"><span class="hs-identifier hs-var">FitsInByte</span></a></span></span><span> </span><span id="local-6989586621679537922"><span class="annot"><a href="#local-6989586621679537922"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#FitsInByteResult"><span class="hs-identifier hs-type">FitsInByteResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537922"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=?</span></span><span> </span><span class="annot"><span class="hs-number">255</span></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="FitsInByteResult"><span class="annot"><a href="Data.Store.Impl.html#FitsInByteResult"><span class="hs-identifier hs-var">FitsInByteResult</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679537920"><span class="annot"><a href="#local-6989586621679537920"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span id="FitsInByteResult"><span class="annot"><a href="Data.Store.Impl.html#FitsInByteResult"><span class="hs-identifier hs-var">FitsInByteResult</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span id="FitsInByteResult"><span class="annot"><a href="Data.Store.Impl.html#FitsInByteResult"><span class="hs-identifier hs-var">FitsInByteResult</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#TypeErrorMessage"><span class="hs-identifier hs-type">TypeErrorMessage</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="hs-string">&quot;Generic deriving of Store instances can only be used on datatypes with fewer than 256 constructors.&quot;</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="TypeErrorMessage"><span class="annot"><a href="Data.Store.Impl.html#TypeErrorMessage"><span class="hs-identifier hs-var">TypeErrorMessage</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679537918"><span class="annot"><a href="#local-6989586621679537918"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">
#if MIN_VERSION_base(4,9,0)
</span><span>    </span><span id="TypeErrorMessage"><span class="annot"><a href="Data.Store.Impl.html#TypeErrorMessage"><span class="hs-identifier hs-var">TypeErrorMessage</span></a></span></span><span> </span><span id="local-6989586621679537917"><span class="annot"><a href="#local-6989586621679537917"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679537917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- GHC &lt; 8.0 does not support empty closed type families</span><span class="hs-cpp">
#elif __GLASGOW_HASKELL__ &lt; 800
</span><span>    </span><span class="hs-identifier">TypeErrorMessage</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Similarly to splitting up the generic class into multiple classes, we</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- also split up the one for sum types.</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679538150"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="GStoreSizeSum"><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-var">GStoreSizeSum</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538150"><span class="annot"><a href="#local-6989586621679538150"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538149"><span class="annot"><a href="#local-6989586621679538149"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538148"><span id="gsizeSum"><span class="annot"><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-identifier hs-type">gsizeSum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679538149"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538148"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679538150"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-301"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679538143"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="GStorePokeSum"><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-var">GStorePokeSum</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538143"><span class="annot"><a href="#local-6989586621679538143"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538142"><span class="annot"><a href="#local-6989586621679538142"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538141"><span id="gpokeSum"><span class="annot"><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-identifier hs-type">gpokeSum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679538142"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538141"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679538143"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Poke</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-302"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679538135"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="GStorePeekSum"><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-var">GStorePeekSum</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538135"><span class="annot"><a href="#local-6989586621679538135"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679538134"><span class="annot"><a href="#local-6989586621679538134"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679538133"><span id="gpeekSum"><span class="annot"><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-identifier hs-type">gpeekSum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679538135"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679538134"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679538133"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621679537914"><span id="local-6989586621679537915"><span id="local-6989586621679537916"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-type">GStoreSizeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537915"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-type">GStoreSizeSum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537915"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679537914"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-type">GStoreSizeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537915"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537914"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>    </span><span id="local-6989586621679537910"><span class="annot"><span class="annottext">gsizeSum :: (:+:) a b a -&gt; Proxy n -&gt; Int
</span><a href="#local-6989586621679537910"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsizeSum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L1</span></span><span> </span><span id="local-6989586621679537908"><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537908"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a a -&gt; Proxy n -&gt; Int
forall (n :: Nat) (f :: * -&gt; *) a.
GStoreSizeSum n f =&gt;
f a -&gt; Proxy n -&gt; Int
</span><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-identifier hs-var">gsizeSum</span></a></span><span> </span><span class="annot"><span class="annottext">a a
</span><a href="#local-6989586621679537908"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-identifier hs-var">gsizeSum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R1</span></span><span> </span><span id="local-6989586621679537906"><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537906"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b a -&gt; Proxy (n + SumArity a) -&gt; Int
forall (n :: Nat) (f :: * -&gt; *) a.
GStoreSizeSum n f =&gt;
f a -&gt; Proxy n -&gt; Int
</span><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-identifier hs-var">gsizeSum</span></a></span><span> </span><span class="annot"><span class="annottext">b a
</span><a href="#local-6989586621679537906"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (n + SumArity a)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537916"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537915"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-pragma hs-type">gsizeSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-309"></span><span id="local-6989586621679537903"><span id="local-6989586621679537904"><span id="local-6989586621679537905"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-type">GStorePokeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537904"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-type">GStorePokeSum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537904"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679537903"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-type">GStorePokeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537904"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537903"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679537899"><span class="annot"><span class="annottext">gpokeSum :: (:+:) a b p -&gt; Proxy n -&gt; Poke ()
</span><a href="#local-6989586621679537899"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpokeSum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">L1</span></span><span> </span><span id="local-6989586621679537898"><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679537898"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a p -&gt; Proxy n -&gt; Poke ()
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePokeSum n f =&gt;
f p -&gt; Proxy n -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-identifier hs-var">gpokeSum</span></a></span><span> </span><span class="annot"><span class="annottext">a p
</span><a href="#local-6989586621679537898"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-identifier hs-var">gpokeSum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R1</span></span><span> </span><span id="local-6989586621679537897"><span class="annot"><span class="annottext">b p
</span><a href="#local-6989586621679537897"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b p -&gt; Proxy (n + SumArity a) -&gt; Poke ()
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePokeSum n f =&gt;
f p -&gt; Proxy n -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-identifier hs-var">gpokeSum</span></a></span><span> </span><span class="annot"><span class="annottext">b p
</span><a href="#local-6989586621679537897"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (n + SumArity a)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537905"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537904"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-pragma hs-type">gpokeSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-314"></span><span id="local-6989586621679537894"><span id="local-6989586621679537895"><span id="local-6989586621679537896"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-type">GStorePeekSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-type">GStorePeekSum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679537894"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-type">GStorePeekSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537895"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:+:</span></span><span> </span><span class="annot"><a href="#local-6989586621679537894"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679537890"><span class="annot"><span class="annottext">gpeekSum :: Word8 -&gt; Proxy n -&gt; Peek ((:+:) a b p)
</span><a href="#local-6989586621679537890"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeekSum</span></a></span></span><span> </span><span id="local-6989586621679537889"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537889"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621679537888"><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621679537888"><span class="hs-identifier hs-var">proxyL</span></a></span></span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537889"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537886"><span class="hs-identifier hs-var">sizeL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a p -&gt; (:+:) a b p
forall k (f :: k -&gt; *) (g :: k -&gt; *) (p :: k). f p -&gt; (:+:) f g p
</span><span class="hs-identifier hs-var">L1</span></span><span> </span><span class="annot"><span class="annottext">(a p -&gt; (:+:) a b p) -&gt; Peek (a p) -&gt; Peek ((:+:) a b p)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Proxy n -&gt; Peek (a p)
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePeekSum n f =&gt;
Word8 -&gt; Proxy n -&gt; Peek (f p)
</span><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-identifier hs-var">gpeekSum</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537889"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621679537888"><span class="hs-identifier hs-var">proxyL</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b p -&gt; (:+:) a b p
forall k (f :: k -&gt; *) (g :: k -&gt; *) (p :: k). g p -&gt; (:+:) f g p
</span><span class="hs-identifier hs-var">R1</span></span><span> </span><span class="annot"><span class="annottext">(b p -&gt; (:+:) a b p) -&gt; Peek (b p) -&gt; Peek ((:+:) a b p)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Proxy (n + SumArity a) -&gt; Peek (b p)
forall (n :: Nat) (f :: * -&gt; *) p.
GStorePeekSum n f =&gt;
Word8 -&gt; Proxy n -&gt; Peek (f p)
</span><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-identifier hs-var">gpeekSum</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537889"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (n + SumArity a)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621679537886"><span class="annot"><span class="annottext">sizeL :: Word8
</span><a href="#local-6989586621679537886"><span class="hs-identifier hs-var hs-var">sizeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word8
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (n + SumArity a) -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (n + SumArity a)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679537896"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Data.Store.Impl.html#SumArity"><span class="hs-identifier hs-type">SumArity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537895"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-pragma hs-type">gpeekSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span id="local-6989586621679537882"><span id="local-6989586621679537883"><span id="local-6989586621679537884"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStoreSize"><span class="hs-identifier hs-type">GStoreSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537884"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537883"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStoreSizeSum"><span class="hs-identifier hs-type">GStoreSizeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537883"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537882"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537884"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679537879"><span class="annot"><span class="annottext">gsizeSum :: C1 c a a -&gt; Proxy n -&gt; Int
</span><a href="#local-6989586621679537879"><span class="hs-identifier hs-var hs-var hs-var hs-var">gsizeSum</span></a></span></span><span> </span><span id="local-6989586621679537878"><span class="annot"><span class="annottext">C1 c a a
</span><a href="#local-6989586621679537878"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Size (C1 c a a) -&gt; C1 c a a -&gt; Int
forall a. Size a -&gt; a -&gt; Int
</span><a href="Data.Store.Impl.html#getSizeWith"><span class="hs-identifier hs-var">getSizeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Size (C1 c a a)
forall (f :: * -&gt; *) a. GStoreSize f =&gt; Size (f a)
</span><a href="Data.Store.Impl.html#gsize"><span class="hs-identifier hs-var">gsize</span></a></span><span> </span><span class="annot"><span class="annottext">C1 c a a
</span><a href="#local-6989586621679537878"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gsizeSum"><span class="hs-pragma hs-type">gsizeSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-326"></span><span id="local-6989586621679537875"><span id="local-6989586621679537876"><span id="local-6989586621679537877"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePoke"><span class="hs-identifier hs-type">GStorePoke</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537877"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537876"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePokeSum"><span class="hs-identifier hs-type">GStorePokeSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537876"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537875"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537877"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679537872"><span class="annot"><span class="annottext">gpokeSum :: C1 c a p -&gt; Proxy n -&gt; Poke ()
</span><a href="#local-6989586621679537872"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpokeSum</span></a></span></span><span> </span><span id="local-6989586621679537871"><span class="annot"><span class="annottext">C1 c a p
</span><a href="#local-6989586621679537871"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">Word8 -&gt; Poke ()
forall a. Storable a =&gt; a -&gt; Poke ()
</span><span class="hs-identifier hs-var">pokeStorable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Word8
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679537876"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">C1 c a p -&gt; Poke ()
forall (f :: * -&gt; *) a. GStorePoke f =&gt; f a -&gt; Poke ()
</span><a href="Data.Store.Impl.html#gpoke"><span class="hs-identifier hs-var">gpoke</span></a></span><span> </span><span class="annot"><span class="annottext">C1 c a p
</span><a href="#local-6989586621679537871"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpokeSum"><span class="hs-pragma hs-type">gpokeSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-331"></span><span id="local-6989586621679537867"><span id="local-6989586621679537868"><span id="local-6989586621679537869"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Store.Impl.html#GStorePeek"><span class="hs-identifier hs-type">GStorePeek</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537869"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679537868"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#GStorePeekSum"><span class="hs-identifier hs-type">GStorePeekSum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537868"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C1</span></span><span> </span><span class="annot"><a href="#local-6989586621679537867"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679537869"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-332"></span><span>    </span><span id="local-6989586621679537864"><span class="annot"><span class="annottext">gpeekSum :: Word8 -&gt; Proxy n -&gt; Peek (C1 c a p)
</span><a href="#local-6989586621679537864"><span class="hs-identifier hs-var hs-var hs-var hs-var">gpeekSum</span></a></span></span><span> </span><span id="local-6989586621679537863"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537863"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537863"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537862"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Peek (C1 c a p)
forall (f :: * -&gt; *) a. GStorePeek f =&gt; Peek (f a)
</span><a href="Data.Store.Impl.html#gpeek"><span class="hs-identifier hs-var">gpeek</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537863"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679537862"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Peek (C1 c a p)
forall a. Text -&gt; Peek a
</span><span class="hs-identifier hs-var">peekException</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Sum tag invalid&quot;</span></span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Peek (C1 c a p)
forall a. Text -&gt; Peek a
</span><span class="hs-identifier hs-var">peekException</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error in implementation of Store Generics&quot;</span></span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>        </span><span id="local-6989586621679537862"><span class="annot"><span class="annottext">cur :: Word8
</span><a href="#local-6989586621679537862"><span class="hs-identifier hs-var hs-var">cur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word8
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n -&gt; Integer
forall (n :: Nat) (proxy :: Nat -&gt; *).
KnownNat n =&gt;
proxy n -&gt; Integer
</span><span class="hs-identifier hs-var">natVal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679537868"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Data.Store.Impl.html#gpeekSum"><span class="hs-pragma hs-type">gpeekSum</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-339"></span></pre></body></html>